<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adaptive Registration</title>
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { max-width: 900px; margin: 24px auto; padding: 0 16px; }
    h2 { margin: 0 0 12px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .full { grid-column: 1 / -1; }
    label { display: block; font-size: 14px; margin-bottom: 6px; }
    input, select, textarea {
      width: 100%; box-sizing: border-box;
      padding: 10px 12px; border: 1px solid #cfd4dc; border-radius: 10px;
      outline: none;
    }
    textarea { min-height: 70px; resize: vertical; }
    .hint { font-size: 12px; color: #5b6573; margin-top: 6px; }
    .error { font-size: 12px; color: #b42318; margin-top: 6px; display: none; }
    .ok { font-size: 12px; color: #067647; margin-top: 6px; display: none; }
    .invalid input, .invalid select, .invalid textarea { border-color: #b42318; background: #fff5f5; }
    .valid input, .valid select, .valid textarea { border-color: #067647; background: #f0fff4; }
    .row { margin-bottom: 2px; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chips label { display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px; border: 1px solid #cfd4dc; border-radius: 999px; margin: 0; cursor: pointer; }
    .chips input { width: auto; }
    .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; background: #fff; }
    .barWrap { height: 10px; background: #eef2f7; border-radius: 999px; overflow: hidden; }
    .bar { height: 100%; width: 0%; transition: width .2s; }
    .actions { display: flex; gap: 10px; align-items: center; margin-top: 14px; }
    button {
      padding: 10px 14px; border: 0; border-radius: 12px;
      cursor: pointer; font-weight: 600;
    }
    button:disabled { opacity: .55; cursor: not-allowed; }
    .primary { background: #2563eb; color: white; }
    .ghost { background: #eef2ff; color: #1e40af; }
    .summary {
      margin-top: 14px; padding: 12px 14px; border-radius: 12px;
      background: #f8fafc; border: 1px dashed #cbd5e1; font-size: 14px;
    }
    .hidden { display: none !important; }
    @media (max-width: 760px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <h2>Adaptive Registration Form</h2>
  <p class="hint">
    Rules change based on Role. Admin requires a stronger password and company email; Teacher needs subject + institution;
    Student needs school/college + age restriction; skills minimum varies.
  </p>

  <form id="regForm" class="card" novalidate>
    <div class="grid">

      <!-- Name -->
      <div class="row" id="wrapName">
        <label for="name">Name</label>
        <input id="name" type="text" placeholder="Your full name" autocomplete="name" />
        <div class="error" id="errName"></div>
      </div>

      <!-- Age -->
      <div class="row" id="wrapAge">
        <label for="age">Age</label>
        <input id="age" type="number" min="1" placeholder="e.g., 18" />
        <div class="error" id="errAge"></div>
      </div>

      <!-- Email -->
      <div class="row" id="wrapEmail">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="name@example.com" autocomplete="email" />
        <div class="error" id="errEmail"></div>
        <div class="ok" id="okEmail">Email looks good.</div>
      </div>

      <!-- Role -->
      <div class="row" id="wrapRole">
        <label for="role">Role</label>
        <select id="role">
          <option value="student">Student</option>
          <option value="teacher">Teacher</option>
          <option value="admin">Admin</option>
        </select>
        <div class="hint" id="roleHint"></div>
      </div>

      <!-- Password -->
      <div class="row" id="wrapPass">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="Create a password" autocomplete="new-password" />
        <div class="hint" id="passHint"></div>
        <div class="error" id="errPass"></div>

        <div style="margin-top:10px;">
          <div class="barWrap"><div class="bar" id="strengthBar"></div></div>
          <div class="hint" id="strengthText" style="margin-top:8px;"></div>
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="row" id="wrapCpass">
        <label for="confirm">Confirm Password</label>
        <input id="confirm" type="password" placeholder="Re-type password" autocomplete="new-password" />
        <div class="error" id="errCpass"></div>
      </div>

      <!-- Dynamic fields -->
      <div class="row full hidden" id="wrapInstitution">
        <label for="institution">Institution (Teacher)</label>
        <input id="institution" type="text" placeholder="e.g., ABC High School" />
        <div class="error" id="errInstitution"></div>
      </div>

      <div class="row full hidden" id="wrapSubject">
        <label for="subject">Subject (Teacher)</label>
        <input id="subject" type="text" placeholder="e.g., Mathematics" />
        <div class="error" id="errSubject"></div>
      </div>

      <div class="row full hidden" id="wrapDept">
        <label for="department">Department (Admin)</label>
        <select id="department">
          <option value="">Select department</option>
          <option>IT</option>
          <option>HR</option>
          <option>Finance</option>
          <option>Operations</option>
        </select>
        <div class="error" id="errDept"></div>
      </div>

      <div class="row full hidden" id="wrapCode">
        <label for="adminCode">Admin Code (Admin)</label>
        <input id="adminCode" type="text" placeholder="e.g., ADM-2026" />
        <div class="error" id="errCode"></div>
      </div>

      <div class="row full hidden" id="wrapSchool">
        <label for="school">School/College (Student)</label>
        <input id="school" type="text" placeholder="e.g., XYZ College" />
        <div class="error" id="errSchool"></div>
      </div>

      <!-- Skills -->
      <div class="row full" id="wrapSkills">
        <label>Skills (select at least the required number)</label>
        <div class="chips" id="skillsBox">
          <label><input type="checkbox" value="HTML"> HTML</label>
          <label><input type="checkbox" value="CSS"> CSS</label>
          <label><input type="checkbox" value="JavaScript"> JavaScript</label>
          <label><input type="checkbox" value="Python"> Python</label>
          <label><input type="checkbox" value="C"> C</label>
          <label><input type="checkbox" value="SQL"> SQL</label>
          <label><input type="checkbox" value="Communication"> Communication</label>
          <label><input type="checkbox" value="Leadership"> Leadership</label>
        </div>
        <div class="hint" id="skillsHint"></div>
        <div class="error" id="errSkills"></div>
      </div>

      <div class="row full">
        <div class="actions">
          <button class="primary" id="submitBtn" type="submit" disabled>Register</button>
          <button class="ghost" type="button" id="resetBtn">Reset</button>
          <span class="hint" id="formStatus">Fill all required fields to enable Register.</span>
        </div>
        <div class="summary hidden" id="preview"></div>
      </div>

    </div>
  </form>

  <script>
    // ---------- Helpers ----------
    const $ = (id) => document.getElementById(id);

    function setWrapState(wrapId, isValid, messageId, messageText, okId) {
      const wrap = $(wrapId);
      if (!wrap) return;

      wrap.classList.remove("valid", "invalid");
      const msg = messageId ? $(messageId) : null;
      const ok = okId ? $(okId) : null;

      if (msg) { msg.style.display = "none"; msg.textContent = ""; }
      if (ok) ok.style.display = "none";

      if (isValid === true) {
        wrap.classList.add("valid");
        if (ok) ok.style.display = "block";
      } else if (isValid === false) {
        wrap.classList.add("invalid");
        if (msg) { msg.textContent = messageText || "Invalid"; msg.style.display = "block"; }
      }
    }

    function show(id, on) {
      const el = $(id);
      el.classList.toggle("hidden", !on);
    }

    function isEmailFormatValid(email) {
      // Simple format check (browser will also validate type="email", but we do custom feedback)
      return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email.trim());
    }

    function getEmailDomain(email) {
      const at = email.lastIndexOf("@");
      return at >= 0 ? email.slice(at + 1).toLowerCase() : "";
    }

    function selectedSkills() {
      return [...document.querySelectorAll('#skillsBox input[type="checkbox"]:checked')]
        .map(cb => cb.value);
    }

    // ---------- Role rules (dynamic) ----------
    function getRoleRules(role) {
      // You can edit these rules easily
      const common = {
        nameMin: 3,
        ageMin: 13,
        skillsMin: 1,
        allowedDomains: null, // null => any domain allowed
        password: { minLen: 8, requireUpper: true, requireLower: true, requireDigit: true, requireSpecial: false }
      };

      if (role === "student") {
        return {
          ...common,
          ageMin: 13,
          skillsMin: 1,
          requiredFields: ["school"],
          roleHint: "Student: Age ≥ 13, School/College required. Password: 8+ with upper/lower/digit."
        };
      }

      if (role === "teacher") {
        return {
          ...common,
          ageMin: 18,
          skillsMin: 2,
          requiredFields: ["institution", "subject"],
          allowedDomains: null, // any is ok, but must be valid
          password: { minLen: 10, requireUpper: true, requireLower: true, requireDigit: true, requireSpecial: true },
          roleHint: "Teacher: Age ≥ 18, Institution & Subject required. Password: 10+ with special char."
        };
      }

      // admin
      return {
        ...common,
        ageMin: 21,
        skillsMin: 3,
        requiredFields: ["department", "adminCode"],
        allowedDomains: ["company.com", "admin.company.com"], // example domains
        password: { minLen: 12, requireUpper: true, requireLower: true, requireDigit: true, requireSpecial: true },
        roleHint: "Admin: Age ≥ 21, Department & Admin Code required. Email must be company domain. Password: 12+ strong."
      };
    }

    // ---------- Password strength ----------
    function evalPassword(pw, pwRules) {
      const checks = {
        minLen: pw.length >= pwRules.minLen,
        upper: !pwRules.requireUpper || /[A-Z]/.test(pw),
        lower: !pwRules.requireLower || /[a-z]/.test(pw),
        digit: !pwRules.requireDigit || /\d/.test(pw),
        special: !pwRules.requireSpecial || /[^A-Za-z0-9]/.test(pw),
      };

      const total = Object.keys(checks).length;
      const passed = Object.values(checks).filter(Boolean).length;
      const pct = Math.round((passed / total) * 100);

      let label = "Weak";
      if (pct >= 80) label = "Strong";
      else if (pct >= 60) label = "Medium";

      return { checks, passed, total, pct, label, ok: passed === total };
    }

    function renderStrength(pwInfo) {
      const bar = $("strengthBar");
      const text = $("strengthText");

      bar.style.width = pwInfo.pct + "%";
      // no fixed colors required, but using minimal semantic coloring is helpful:
      bar.style.background = pwInfo.pct >= 80 ? "#16a34a" : (pwInfo.pct >= 60 ? "#f59e0b" : "#ef4444");
      text.textContent = `Strength: ${pwInfo.label} (${pwInfo.passed}/${pwInfo.total} rules passed)`;
    }

    // ---------- Validation functions ----------
    function validateName(rules) {
      const v = $("name").value.trim();
      const ok = v.length >= rules.nameMin;
      setWrapState("wrapName", ok, "errName", `Name must be at least ${rules.nameMin} characters.`);
      return ok;
    }

    function validateAge(rules) {
      const raw = $("age").value.trim();
      const n = Number(raw);
      const ok = Number.isFinite(n) && n >= rules.ageMin && n <= 120;
      setWrapState("wrapAge", ok, "errAge", `Age must be between ${rules.ageMin} and 120.`);
      return ok;
    }

    function validateEmail(rules) {
      const email = $("email").value.trim();
      if (!email) {
        setWrapState("wrapEmail", false, "errEmail", "Email is required.", "okEmail");
        return false;
      }
      if (!isEmailFormatValid(email)) {
        setWrapState("wrapEmail", false, "errEmail", "Enter a valid email (example: name@example.com).", "okEmail");
        return false;
      }

      const domain = getEmailDomain(email);

      // basic domain sanity: must contain at least one dot and not start/end with dot
      const domainOk = /^[a-z0-9.-]+\.[a-z]{2,}$/.test(domain) && !domain.startsWith(".") && !domain.endsWith(".");
      if (!domainOk) {
        setWrapState("wrapEmail", false, "errEmail", "Email domain looks invalid.", "okEmail");
        return false;
      }

      if (rules.allowedDomains && !rules.allowedDomains.includes(domain)) {
        setWrapState(
          "wrapEmail",
          false,
          "errEmail",
          `For ${$("role").value.toUpperCase()}, email must be: ${rules.allowedDomains.join(", ")}`,
          "okEmail"
        );
        return false;
      }

      setWrapState("wrapEmail", true, "errEmail", "", "okEmail");
      return true;
    }

    function validatePassword(rules) {
      const pw = $("password").value;
      const info = evalPassword(pw, rules.password);
      renderStrength(info);

      const needed = [];
      if (rules.password.minLen) needed.push(`${rules.password.minLen}+ chars`);
      if (rules.password.requireUpper) needed.push("uppercase");
      if (rules.password.requireLower) needed.push("lowercase");
      if (rules.password.requireDigit) needed.push("number");
      if (rules.password.requireSpecial) needed.push("special char");

      $("passHint").textContent = `Required: ${needed.join(", ")}.`;

      if (!pw) {
        setWrapState("wrapPass", false, "errPass", "Password is required.");
        return false;
      }

      if (!info.ok) {
        setWrapState("wrapPass", false, "errPass", "Password does not meet the required rules.");
        return false;
      }

      setWrapState("wrapPass", true, "errPass", "");
      return true;
    }

    function validateConfirmPassword() {
      const pw = $("password").value;
      const cpw = $("confirm").value;

      if (!cpw) {
        setWrapState("wrapCpass", false, "errCpass", "Please confirm your password.");
        return false;
      }
      const ok = pw === cpw;
      setWrapState("wrapCpass", ok, "errCpass", "Passwords do not match.");
      return ok;
    }

    function validateSkills(rules) {
      const skills = selectedSkills();
      $("skillsHint").textContent = `Minimum required for ${$("role").value}: ${rules.skillsMin} skill(s). Selected: ${skills.length}.`;

      const ok = skills.length >= rules.skillsMin;
      setWrapState("wrapSkills", ok, "errSkills", `Select at least ${rules.skillsMin} skill(s).`);
      return ok;
    }

    function validateDynamicFields(rules) {
      let ok = true;

      // Teacher fields
      if (rules.requiredFields.includes("institution")) {
        const v = $("institution").value.trim();
        const vOk = v.length >= 2;
        setWrapState("wrapInstitution", vOk, "errInstitution", "Institution is required (min 2 chars).");
        ok = ok && vOk;
      }

      if (rules.requiredFields.includes("subject")) {
        const v = $("subject").value.trim();
        const vOk = v.length >= 2;
        setWrapState("wrapSubject", vOk, "errSubject", "Subject is required (min 2 chars).");
        ok = ok && vOk;
      }

      // Admin fields
      if (rules.requiredFields.includes("department")) {
        const v = $("department").value;
        const vOk = v.trim() !== "";
        setWrapState("wrapDept", vOk, "errDept", "Please select a department.");
        ok = ok && vOk;
      }

      if (rules.requiredFields.includes("adminCode")) {
        const v = $("adminCode").value.trim();
        // Example: ADM- followed by 3-6 digits, e.g., ADM-2026
        const vOk = /^ADM-\d{3,6}$/.test(v);
        setWrapState("wrapCode", vOk, "errCode", "Admin Code must look like ADM-2026 (3–6 digits).");
        ok = ok && vOk;
      }

      // Student field
      if (rules.requiredFields.includes("school")) {
        const v = $("school").value.trim();
        const vOk = v.length >= 2;
        setWrapState("wrapSchool", vOk, "errSchool", "School/College is required (min 2 chars).");
        ok = ok && vOk;
      }

      return ok;
    }

    function applyRoleUI(rules) {
      // Show/hide role-based fields
      const role = $("role").value;

      show("wrapInstitution", role === "teacher");
      show("wrapSubject", role === "teacher");

      show("wrapDept", role === "admin");
      show("wrapCode", role === "admin");

      show("wrapSchool", role === "student");

      $("roleHint").textContent = rules.roleHint;

      // Reset dynamic field states when hidden to avoid confusing UI
      if (role !== "teacher") {
        $("institution").value = $("institution").value; // keep value, but clear validation look
        $("subject").value = $("subject").value;
        $("wrapInstitution").classList.remove("valid","invalid");
        $("wrapSubject").classList.remove("valid","invalid");
        $("errInstitution").style.display = "none";
        $("errSubject").style.display = "none";
      }
      if (role !== "admin") {
        $("wrapDept").classList.remove("valid","invalid");
        $("wrapCode").classList.remove("valid","invalid");
        $("errDept").style.display = "none";
        $("errCode").style.display = "none";
      }
      if (role !== "student") {
        $("wrapSchool").classList.remove("valid","invalid");
        $("errSchool").style.display = "none";
      }

      // Admin: communicate email domain rules
      if (rules.allowedDomains) {
        $("okEmail").textContent = "Company email accepted.";
      } else {
        $("okEmail").textContent = "Email looks good.";
      }
    }

    function validateAll() {
      const role = $("role").value;
      const rules = getRoleRules(role);

      const a = validateName(rules);
      const b = validateAge(rules);
      const c = validateEmail(rules);
      const d = validatePassword(rules);
      const e = validateConfirmPassword();
      const f = validateSkills(rules);
      const g = validateDynamicFields(rules);

      const allOk = a && b && c && d && e && f && g;

      $("submitBtn").disabled = !allOk;
      $("formStatus").textContent = allOk ? "All good — you can register now." : "Fill all required fields to enable Register.";

      // preview card
      if (allOk) {
        const skills = selectedSkills();
        const preview = $("preview");
        const roleLabel = role[0].toUpperCase() + role.slice(1);

        const lines = [
          `✅ Ready to submit`,
          `Name: ${$("name").value.trim()}`,
          `Age: ${$("age").value.trim()}`,
          `Role: ${roleLabel}`,
          `Email: ${$("email").value.trim()}`,
          `Skills: ${skills.join(", ")}`
        ];

        if (role === "student") lines.push(`School/College: ${$("school").value.trim()}`);
        if (role === "teacher") lines.push(`Institution: ${$("institution").value.trim()}`, `Subject: ${$("subject").value.trim()}`);
        if (role === "admin") lines.push(`Department: ${$("department").value}`, `Admin Code: ${$("adminCode").value.trim()}`);

        preview.textContent = lines.join("\n");
        preview.classList.remove("hidden");
      } else {
        $("preview").classList.add("hidden");
      }

      return allOk;
    }

    // ---------- Event wiring ----------
    const form = $("regForm");

    function onAnyInput() { validateAll(); }

    // inputs
    ["name","age","email","password","confirm","institution","subject","adminCode","school"].forEach(id => {
      const el = $(id);
      el.addEventListener("input", onAnyInput);
      el.addEventListener("blur", onAnyInput);
    });

    $("department").addEventListener("change", onAnyInput);
    $("skillsBox").addEventListener("change", onAnyInput);

    $("role").addEventListener("change", () => {
      const rules = getRoleRules($("role").value);
      applyRoleUI(rules);
      validateAll();
    });

    $("resetBtn").addEventListener("click", () => {
      form.reset();
      // reset UI states
      ["wrapName","wrapAge","wrapEmail","wrapPass","wrapCpass","wrapSkills","wrapInstitution","wrapSubject","wrapDept","wrapCode","wrapSchool"]
        .forEach(w => $(w).classList.remove("valid","invalid"));
      ["errName","errAge","errEmail","errPass","errCpass","errSkills","errInstitution","errSubject","errDept","errCode","errSchool"]
        .forEach(e => { const el = $(e); if (el) el.style.display = "none"; });

      $("okEmail").style.display = "none";
      $("preview").classList.add("hidden");
      $("strengthBar").style.width = "0%";
      $("strengthText").textContent = "";

      const rules = getRoleRules($("role").value);
      applyRoleUI(rules);
      validateAll();
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const ok = validateAll();
      if (!ok) return;

      // In real apps: send to server here (fetch/AJAX). For this exercise, just show success.
      alert("Registration successful! (Demo)");
      form.reset();
      $("resetBtn").click();
    });

    // ---------- Init ----------
    const initialRules = getRoleRules($("role").value);
    applyRoleUI(initialRules);
    $("skillsHint").textContent = `Minimum required for ${$("role").value}: ${initialRules.skillsMin} skill(s).`;
    validateAll();
  </script>
</body>
</html>
